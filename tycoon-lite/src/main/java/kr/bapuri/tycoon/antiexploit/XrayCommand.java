package kr.bapuri.tycoon.antiexploit;

import org.bukkit.ChatColor;
import org.bukkit.command.Command;
import org.bukkit.command.CommandExecutor;
import org.bukkit.command.CommandSender;
import org.bukkit.command.TabCompleter;

import java.util.Arrays;
import java.util.Collections;
import java.util.List;
import java.util.stream.Collectors;

/**
 * /xray 명령어 - X-ray 탐지 시스템 관리
 * 
 * [SCAFFOLD] 나중에 구현 예정
 * 
 * 사용법:
 *   /xray inspect <player> - 플레이어 세션 정보 조회
 *   /xray toggle          - 시스템 활성화/비활성화
 *   /xray status          - 시스템 상태 확인
 * 
 * 권한: tycoon.admin.xray
 */
public class XrayCommand implements CommandExecutor, TabCompleter {

    private final XrayHeuristicAnalyzer analyzer;

    public XrayCommand(XrayHeuristicAnalyzer analyzer) {
        this.analyzer = analyzer;
    }

    @Override
    public boolean onCommand(CommandSender sender, Command command, String label, String[] args) {
        if (!sender.hasPermission("tycoon.admin.xray")) {
            sender.sendMessage(ChatColor.RED + "권한이 없습니다.");
            return true;
        }

        if (args.length == 0) {
            showHelp(sender);
            return true;
        }

        String subCommand = args[0].toLowerCase();

        switch (subCommand) {
            case "inspect" -> {
                sender.sendMessage(ChatColor.YELLOW + "[XrayAnalyzer] 아직 구현되지 않았습니다. (SCAFFOLD)");
            }
            case "toggle" -> {
                boolean newState = !analyzer.isEnabled();
                analyzer.setEnabled(newState);
                sender.sendMessage(ChatColor.YELLOW + "[XrayAnalyzer] " +
                        (newState ? ChatColor.GREEN + "활성화됨" : ChatColor.RED + "비활성화됨") +
                        ChatColor.GRAY + " (SCAFFOLD - 실제 기능 없음)");
            }
            case "status" -> {
                sender.sendMessage(ChatColor.GOLD + "=== X-ray 탐지 상태 ===");
                sender.sendMessage(ChatColor.WHITE + "활성화: " +
                        (analyzer.isEnabled() ? ChatColor.GREEN + "예" : ChatColor.RED + "아니오"));
                sender.sendMessage(ChatColor.GRAY + "(SCAFFOLD - 실제 기능 없음)");
            }
            default -> showHelp(sender);
        }

        return true;
    }

    private void showHelp(CommandSender sender) {
        sender.sendMessage(ChatColor.GOLD + "=== X-ray 탐지 명령어 ===");
        sender.sendMessage(ChatColor.YELLOW + "/xray inspect <player>" + ChatColor.WHITE + " - 플레이어 세션 조회");
        sender.sendMessage(ChatColor.YELLOW + "/xray toggle" + ChatColor.WHITE + " - 시스템 활성화/비활성화");
        sender.sendMessage(ChatColor.YELLOW + "/xray status" + ChatColor.WHITE + " - 시스템 상태 확인");
        sender.sendMessage(ChatColor.GRAY + "(SCAFFOLD - 실제 기능 미구현)");
    }

    @Override
    public List<String> onTabComplete(CommandSender sender, Command command, String alias, String[] args) {
        if (!sender.hasPermission("tycoon.admin.xray")) {
            return Collections.emptyList();
        }

        if (args.length == 1) {
            return Arrays.asList("inspect", "toggle", "status").stream()
                    .filter(s -> s.startsWith(args[0].toLowerCase()))
                    .collect(Collectors.toList());
        }

        // inspect의 플레이어 자동완성은 나중에 구현

        return Collections.emptyList();
    }
}
